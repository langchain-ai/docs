---
title: "FMP Data"
---

Access financial market data through natural language queries.

## Overview

The FMP (Financial Modeling Prep) LangChain integration provides a seamless way to access financial market data through natural language queries. This integration offers two main components:

* `FMPDataToolkit`: Creates collections of tools based on natural language queries
* `FMPDataTool`: A single unified tool that automatically selects and uses the appropriate endpoints

The integration leverages LangChain's semantic search capabilities to match user queries with the most relevant FMP API endpoints, making financial data access more intuitive and efficient.

## Setup

```
!pip install -U langchain-fmp-data
```

```
import os# Replace with your actual API keysos.environ["FMP_API_KEY"] = "your-fmp-api-key"  # pragma: allowlist secretos.environ["OPENAI_API_KEY"] = "your-openai-api-key"  # pragma: allowlist secret
```

It's also helpful (but not needed) to set up [LangSmith](https://smith.langchain.com/) for best-in-class observability:

```
# os.environ["LANGSMITH_TRACING"] = "true"# os.environ["LANGSMITH_API_KEY"] = getpass.getpass()
```

## Instantiation

There are two main ways to instantiate the FMP LangChain integration:

1. Using FMPDataToolkit

```
from langchain_fmp_data import FMPDataToolkitquery = "Get stock market prices and technical indicators"# Basic instantiationtoolkit = FMPDataToolkit(query=query)# Instantiation with specific query focusmarket_toolkit = FMPDataToolkit(    query=query,    num_results=5,)# Instantiation with custom configurationcustom_toolkit = FMPDataToolkit(    query="Financial analysis",    num_results=3,    similarity_threshold=0.4,    cache_dir="/custom/cache/path",)
```

2. Using FMPDataTool

```
from langchain_fmp_data import FMPDataToolfrom langchain_fmp_data.tools import ResponseFormat# Basic instantiationtool = FMPDataTool()# Advanced instantiation with custom settingsadvanced_tool = FMPDataTool(    max_iterations=50,    temperature=0.2,)
```

## Invocation

The tools can be invoked in several ways:

### Direct Invocation

```
# Using FMPDataTooltool_direct = FMPDataTool()# Basic query# fmt: offresult = tool.invoke({"query": "What's Apple's current stock price?"})# fmt: on# Advanced query with specific format# fmt: offdetailed_result = tool_direct.invoke(    {        "query": "Compare Tesla and Ford's profit margins",        "response_format": ResponseFormat.BOTH,    })# fmt: on
```

### Using with LangChain Agents

```
from langchain.agents import AgentExecutor, create_openai_functions_agentfrom langchain_openai import ChatOpenAI# Setupllm = ChatOpenAI(temperature=0)toolkit = FMPDataToolkit(    query="Stock analysis",    num_results=3,)tools = toolkit.get_tools()# Create agentprompt = "You are a helpful assistant. Answer the user's questions based on the provided context."agent = create_openai_functions_agent(llm, tools, prompt)agent_executor = AgentExecutor(    agent=agent,    tools=tools,)# Run query# fmt: offresponse = agent_executor.invoke({"input": "What's the PE ratio of Microsoft?"})# fmt: on
```

**API Reference:**[AgentExecutor](https://python.langchain.com/api_reference/langchain/agents/langchain.agents.agent.AgentExecutor.html) | [create\_openai\_functions\_agent](https://python.langchain.com/api_reference/langchain/agents/langchain.agents.openai_functions_agent.base.create_openai_functions_agent.html) | [ChatOpenAI](https://python.langchain.com/api_reference/openai/chat_models/langchain_openai.chat_models.base.ChatOpenAI.html)

## Advanced Usage

You can customize the tool's behavior:

```
# Initialize with custom settingsadvanced_tool = FMPDataTool(    max_iterations=50,  # Increase max iterations for complex queries    temperature=0.2,  # Adjust temperature for more/less focused responses)# Example of a complex multi-part analysisquery = """Analyze Apple's financial health by:1. Examining current ratios and debt levels2. Comparing profit margins to industry average3. Looking at cash flow trends4. Assessing growth metrics"""# fmt: offresponse = advanced_tool.invoke(    {        "query": query,        "response_format": ResponseFormat.BOTH})# fmt: onprint("Detailed Financial Analysis:")print(response)
```

## Chaining

You can chain the tool similar to other tools simply by creating a chain with desired model.

```
from langchain_core.output_parsers import StrOutputParserfrom langchain_openai import ChatOpenAI# Setupllm = ChatOpenAI(temperature=0)toolkit = FMPDataToolkit(query="Stock analysis", num_results=3)tools = toolkit.get_tools()llm_with_tools = llm.bind(functions=tools)output_parser = StrOutputParser()# Create chainrunner = llm_with_tools | output_parser# Run chain# fmt: offresponse = runner.invoke(    {        "input": "What's the PE ratio of Microsoft?"    })# fmt: on
```

**API Reference:**[StrOutputParser](https://python.langchain.com/api_reference/core/output_parsers/langchain_core.output_parsers.string.StrOutputParser.html) | [ChatOpenAI](https://python.langchain.com/api_reference/openai/chat_models/langchain_openai.chat_models.base.ChatOpenAI.html)

## API reference

### FMPDataToolkit

Main class for creating collections of FMP API tools:

```
from typing import Anyfrom langchain.tools import Toolclass FMPDataToolkit:    """Creates a collection of FMP data tools based on queries."""    def __init__(        self,        query: str | None = None,        num_results: int = 3,        similarity_threshold: float = 0.3,        cache_dir: str | None = None,    ): ...    def get_tools(self) -> list[Tool]:        """Returns a list of relevant FMP API tools based on the query."""        ...
```

**API Reference:**[Tool](https://python.langchain.com/api_reference/core/tools/langchain_core.tools.simple.Tool.html)

### FMPDataTool

Unified tool that automatically selects appropriate FMP endpoints:

```
# fmt: offclass FMPDataTool:    """Single unified tool for accessing FMP data through natural language."""    def __init__(            self,            max_iterations: int = 3,            temperature: float = 0.0,    ): ...    def invoke(            self,            input: dict[str, Any],    ) -> str | dict[str, Any]:        """Execute a natural language query against FMP API."""        ...# fmt: on
```

### ResponseFormat

Enum for controlling response format:

```
from enum import Enumclass ResponseFormat(str, Enum):    RAW = "raw"  # Raw API response    ANALYSIS = "text"  # Natural language analysis    BOTH = "both"  # Both raw data and analysis
```

## Related

* Tool [conceptual guide](/src/oss/concepts/tools)
* Tool [how-to guides](/src/oss/how_to/#tools)
