LangChain Agent Auth enables secure access from agents to other systems via OAuth 2.0 credentials. With LangChain Agent Auth, build your agents to securely connect to any system on your behalf.

## Overview

LangChain Agent Auth is designed to solve the challenge of secure authentication for autonomous agents. Instead of embedding credentials directly in agent code or requiring manual intervention for each API call, agents can use the OAuth flow to obtain time-limited access tokens for external services.

The system consists of:
- **Authentication Server**: Manages OAuth flows and stores credentials securely
- **Client SDK**: Python library for easy integration with agents
- **Provider Management**: Configuration for OAuth providers like GitHub, Google Workspace, etc.

## Installation

Install the client SDK:

```bash
pip install langchain-auth
```

For use with LangGraph:
```bash
pip install 'langchain-auth[langgraph]'
```

## Quick Start

### 1. Initialize the Client

```python
from langchain_auth import Client

client = Client(
    api_key="your-api-key",
    api_url="http://localhost:8080"  # Default URL
)
```

### 2. Set Up OAuth Providers

Before agents can authenticate, you need to configure OAuth providers:

```python
# Create GitHub provider
github_provider = await client.create_oauth_provider(
    provider_id="github",
    name="GitHub",
    client_id="your-github-client-id",
    client_secret="your-github-client-secret",
    auth_url="https://github.com/login/oauth/authorize",
    token_url="https://github.com/login/oauth/access_token",
    user_info_url="https://api.github.com/user",
    scopes=["read:user", "repo"]
)
```

### 3. Authenticate from Agent

```python
# Authenticate with GitHub
auth_result = await client.authenticate(
    provider="github",
    scopes=["repo"],
    user_id="user123"
)

if auth_result.needs_auth:
    print(f"Visit: {auth_result.auth_url}")
    # Wait for user to complete OAuth flow
    completed_result = await client.wait_for_completion(
        auth_id=auth_result.auth_id,
        timeout=300
    )
    access_token = completed_result.token
else:
    access_token = auth_result.token

# Use the token to access GitHub API
```

## Client SDK Reference

### Client Class

The main interface for interacting with the authentication service.

#### `authenticate(provider, scopes, user_id=None, agent_id=None)`

Initiates OAuth authentication flow.

**Parameters:**
- `provider` (str): OAuth provider name (e.g., "github", "google_workspace")
- `scopes` (list): Required OAuth scopes
- `user_id` (str, optional): User ID for user-scoped tokens
- `agent_id` (str, optional): Agent ID for agent-scoped tokens

**Returns:** `AuthResult` object

**Example:**
```python
auth_result = await client.authenticate(
    provider="github",
    scopes=["read:user", "repo"],
    user_id="user123"
)
```

#### `wait_for_completion(auth_id, timeout=300)`

Waits for OAuth authentication to be completed by the user.

**Parameters:**
- `auth_id` (str): Authentication ID from `authenticate()` call
- `timeout` (int): Maximum time to wait in seconds

**Returns:** `AuthResult` with access token

**Example:**
```python
if auth_result.needs_auth:
    completed_result = await client.wait_for_completion(
        auth_id=auth_result.auth_id,
        timeout=300
    )
    token = completed_result.token
```

#### `create_oauth_provider(...)`

Creates a new OAuth provider configuration.

**Parameters:**
- `provider_id` (str): Unique provider identifier
- `name` (str): Human-readable provider name
- `client_id` (str): OAuth client ID
- `client_secret` (str): OAuth client secret
- `auth_url` (str): Authorization URL
- `token_url` (str): Token exchange URL
- `user_info_url` (str, optional): User info endpoint URL
- `scopes` (list, optional): Default scopes

**Example:**
```python
provider = await client.create_oauth_provider(
    provider_id="google_workspace",
    name="Google Workspace",
    client_id=os.getenv('GOOGLE_CLIENT_ID'),
    client_secret=os.getenv('GOOGLE_CLIENT_SECRET'),
    auth_url="https://accounts.google.com/o/oauth2/v2/auth",
    token_url="https://oauth2.googleapis.com/token",
    user_info_url="https://www.googleapis.com/oauth2/v2/userinfo",
    scopes=[
        "https://www.googleapis.com/auth/userinfo.email",
        "https://www.googleapis.com/auth/drive"
    ]
)
```

#### `list_oauth_providers()`

Retrieves all configured OAuth providers.

**Returns:** List of `OAuthProvider` objects

**Example:**
```python
providers = await client.list_oauth_providers()
for provider in providers:
    print(f"{provider.provider_id}: {provider.name}")
```

## Usage Examples

### From a LangGraph Agent

When running inside a LangGraph context, the authentication flow uses interrupts for a seamless user experience:

```python
from langchain_auth import Client
from langgraph.graph import StateGraph

def create_agent_with_auth():
    client = Client(api_key="your-api-key")
    
    async def authenticate_node(state):
        # This will interrupt and prompt user for OAuth
        auth_result = await client.authenticate(
            provider="github",
            scopes=["repo"],
            user_id=state["user_id"]
        )
        
        # When resumed, token will be available
        state["github_token"] = auth_result.token
        return state
    
    # Add to your LangGraph workflow
    graph = StateGraph(...)
    graph.add_node("auth", authenticate_node)
    return graph.compile()
```

### Outside of LangGraph Context

Here's a basic agent that uses GitHub authentication outside of LangGraph:

```python
import asyncio
from langchain_auth import Client

async def simple_github_agent():
    """A simple agent that authenticates with GitHub and fetches user info."""
    client = Client(api_key="your-api-key")
    
    try:
        # Authenticate with GitHub
        auth_result = await client.authenticate(
            provider="github",
            scopes=["read:user"],
            user_id="agent_user"
        )
        
        # Handle OAuth flow if needed
        if auth_result.needs_auth:
            print(f"Please complete OAuth at: {auth_result.auth_url}")
            auth_result = await client.wait_for_completion(auth_result.auth_id)
        
        # Now we have a token - agent can use it for GitHub API calls
        token = auth_result.token
        print(f"Agent authenticated successfully!")
        
        # Example: Use token with GitHub API
        import httpx
        async with httpx.AsyncClient() as http_client:
            response = await http_client.get(
                "https://api.github.com/user",
                headers={"Authorization": f"Bearer {token}"}
            )
            user_data = response.json()
            print(f"Authenticated as: {user_data['login']}")
        
    finally:
        await client.close()

# Run the agent
asyncio.run(simple_github_agent())
```
