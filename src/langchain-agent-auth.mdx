LangChain Agent Auth enables secure access from agents to other systems via OAuth 2.0 credentials. With LangChain Agent Auth, build your agents to securely connect to any system on your behalf.

## Overview

LangChain Agent Auth is designed to solve the challenge of secure authentication for autonomous agents. Instead of embedding credentials directly in agent code or requiring manual intervention for each API call, agents can use the OAuth flow to obtain time-limited access tokens for external services.

The system consists of:
- **Authentication Server**: Manages OAuth flows and stores credentials securely
- **Client SDK**: Python library for easy integration with agents

## Installation

Install the client SDK for use with LangGraph:
```bash
pip install 'langchain-auth[langgraph]'
```

or for use outside of LangGraph:
```bash
pip install langchain-auth
```


## Quick Start

### 1. Initialize the Client

```python
from langchain_auth import Client

client = Client(api_key="your-langsmith-api-key")
```

### 2. Set Up OAuth Providers

Before agents can authenticate, you need to configure OAuth providers:

```python
# Create GitHub provider
github_provider = await client.create_oauth_provider(
    provider_id="github",
    name="GitHub",
    client_id="your-github-client-id",
    client_secret="your-github-client-secret",
    auth_url="https://github.com/login/oauth/authorize",
    token_url="https://github.com/login/oauth/access_token",
    user_info_url="https://api.github.com/user",
    scopes=["repo"] # Provide one or more scopes you would like to be available for this provider
)
```

### 3. Authenticate from Agent

#### In LangGraph Context

When authentication is required, the sdk will throw an [interrupt](https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/add-human-in-the-loop/#pause-using-interrupt). After the caller completes the OAuth flow out of band, execution will resume from the same point.

```python
# Default: agent-scoped token (restricted to this assistant)
auth_result = await client.authenticate(
    provider="github",
    scopes=["repo"],
    user_id="your_user_id" # Any unique identifier to scope this token to the human caller
)

# OAuth flow is handled automatically via interrupts

token = auth_result.token  # Ready to use after OAuth completes
```

If you need a token that works across multiple agents:

```python
# User-scoped token (works for any agent under this user)
auth_result = await client.authenticate(
    provider="github",
    scopes=["repo"],
    user_id="your_user_id",
    agent_scoped=False
)
```

#### Outside LangGraph Context

Grab the auth_url and provide it to the user for out-of-band OAuth flow.


```python
# Default: user-scoped token (works for any agent under this user)
auth_result = await client.authenticate(
    provider="github",
    scopes=["repo"],
    user_id="your_user_id"
)

if auth_result.needs_auth:
    print(f"Complete OAuth at: {auth_result.auth_url}")
    # Wait for completion
    completed_auth = await client.wait_for_completion(auth_result.auth_id)
    token = completed_auth.token
else:
    token = auth_result.token
```

## Usage Examples

### From a LangGraph Agent

When running inside a LangGraph context, the authentication flow uses interrupts for a seamless user experience:

```python
from langchain_auth import Client
from langgraph.graph import StateGraph

def create_agent_with_auth():
    client = Client(api_key="your-api-key")
    
    async def authenticate_node(state):
        # This will interrupt and prompt user for OAuth
        auth_result = await client.authenticate(
            provider="github",
            scopes=["repo"],
            user_id=state["user_id"]
        )
        
        # When resumed, token will be available
        state["github_token"] = auth_result.token
        return state
    
    # Add to your LangGraph workflow
    graph = StateGraph(...)
    graph.add_node("auth", authenticate_node)
    return graph.compile()
```

### Outside of LangGraph Context

Here's a basic agent that uses GitHub authentication outside of LangGraph:

```python
import asyncio
from langchain_auth import Client

async def simple_github_agent():
    """A simple agent that authenticates with GitHub and fetches user info."""
    client = Client(api_key="your-api-key")
    
    try:
        # Authenticate with GitHub
        auth_result = await client.authenticate(
            provider="github",
            scopes=["read:user"],
            user_id="agent_user"
        )
        
        # Handle OAuth flow if needed
        if auth_result.needs_auth:
            print(f"Please complete OAuth at: {auth_result.auth_url}")
            auth_result = await client.wait_for_completion(auth_result.auth_id)
        
        # Now we have a token - agent can use it for GitHub API calls
        token = auth_result.token
        print(f"Agent authenticated successfully!")
        
        # Example: Use token with GitHub API
        import httpx
        async with httpx.AsyncClient() as http_client:
            response = await http_client.get(
                "https://api.github.com/user",
                headers={"Authorization": f"Bearer {token}"}
            )
            user_data = response.json()
            print(f"Authenticated as: {user_data['login']}")
        
    finally:
        await client.close()

# Run the agent
asyncio.run(simple_github_agent())
```
